# 🛡️ 安全开发与数据隐私规则

## 1. 文档目的
建立安全第一的开发文化，确保在软件开发生命周期的每个阶段都融入安全考虑。

## 2. 安全开发生命周期 (SDL)

### 2.1 各阶段安全要求
```yaml
需求阶段:
  - 安全需求分析
  - 隐私影响评估
  - 合规性要求确认

设计阶段:
  - 威胁建模
  - 安全架构评审
  - 数据流向分析

开发阶段:
  - 安全编码规范
  - 依赖组件安全检查
  - 代码安全扫描

测试阶段:
  - 安全专项测试
  - 渗透测试
  - 漏洞扫描

运维阶段:
  - 安全监控
  - 漏洞响应
  - 安全更新
```

## 3. 通用安全编码规范

### 3.1 输入验证
**所有项目类型通用**：
```java
// 后端示例 - 多层验证
public class UserController {
    
    // 1. 框架级验证 (注解)
    @PostMapping("/users")
    public User createUser(@Valid @RequestBody UserCreateDTO dto) {
        // 2. 业务逻辑验证
        if (userService.existsByEmail(dto.getEmail())) {
            throw new DuplicateEmailException();
        }
        // 3. 持久化前的最终验证
        return userService.createUser(dto);
    }
}
```

```typescript
// 前端示例 - 客户端验证 + 服务端验证
// 不要依赖客户端验证作为唯一安全措施
const validateUserInput = (input) => {
    // 类型检查
    if (typeof input.email !== 'string') return false;
    
    // 格式验证
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(input.email)) return false;
    
    // 长度限制
    if (input.name.length > 100) return false;
    
    return true;
};
```

### 3.2 常见漏洞防护

#### SQL注入防护
```java
// ❌ 错误做法
String sql = "SELECT * FROM users WHERE name = '" + name + "'";

// ✅ 正确做法 - 使用预编译语句
@Query("SELECT u FROM User u WHERE u.name = :name")
User findByName(@Param("name") String name);
```

#### XSS防护
```html
<!-- ❌ 错误做法 -->
<div><%= userControlledContent %></div>

<!-- ✅ 正确做法 - 现代前端框架默认转义 -->
<div>{{ userControlledContent }}</div>

<!-- 手动转义 -->
<div><%= escapeHtml(userControlledContent) %></div>
```

#### CSRF防护
```java
// Spring Security 配置
@Override
protected void configure(HttpSecurity http) throws Exception {
    http.csrf().csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse());
}
```

## 4. 数据隐私规范

### 4.1 数据分类标准
```yaml
公开数据:
  示例: 产品目录，公开API文档
  处理要求: 无特殊限制

内部数据:
  示例: 内部文档，日志文件
  处理要求: 禁止对外泄露

敏感数据:
  示例: 用户手机号，邮箱，设备标识
  处理要求: 加密存储，访问控制

高度敏感数据:
  示例: 密码，身份证号，支付信息
  处理要求: 强加密，最小权限，审计日志
```

### 4.2 隐私设计原则
1. **数据最小化**：只收集业务必需的数据
2. **目的限制**：按声明的目的使用数据
3. **存储限制**：定期清理过期数据
4. **透明度**：向用户明确说明数据使用方式
5. **用户权利**：支持数据查询、更正、删除

## 5. 项目类型特定的安全考虑

### 5.1 移动应用安全
```yaml
数据存储:
  - 敏感数据使用KeyChain/KeyStore
  - 本地数据库加密
  - 避免日志泄露敏感信息

通信安全:
  - 强制HTTPS，证书锁定
  - 防止中间人攻击

反逆向工程:
  - 代码混淆
  - 反调试检测
  - 完整性校验
```

### 5.2 游戏项目安全
```yaml
反作弊:
  - 关键逻辑服务器校验
  - 客户端数据防篡改
  - 行为模式分析

经济系统:
  - 虚拟货币交易日志
  - 物品复制防护
  - 交易回滚机制

用户数据:
  - 存档数据加密
  - 防进度篡改
  - 隐私政策明确
```

### 5.3 Web应用安全
```yaml
前端安全:
  - CSP (内容安全策略)
  - 安全的Cookie设置
  - 点击劫持防护

API安全:
  - 速率限制
  - 认证授权
  - 请求签名

基础设施:
  - WAF (Web应用防火墙)
  - DDoS防护
  - 安全头部
```

## 6. 安全工具链

### 6.1 自动化安全扫描
```yaml
依赖扫描:
  - OWASP Dependency Check
  - Snyk
  - GitHub Security Advisories

代码扫描:
  - SonarQube
  - Semgrep
  - CodeQL

动态扫描:
  - OWASP ZAP
  - Nessus
  - 自定义安全测试用例
```