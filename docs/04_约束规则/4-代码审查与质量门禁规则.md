# 📋 代码审查与质量门禁规则

## 1. 文档目的
建立标准化的代码审查流程和质量门禁机制，确保代码质量在合并前得到有效控制，防止技术债务积累。

## 2. 代码审查规范

### 2.1 审查流程
```
开发者提交PR → 自动化检查 → 人工审查 → 修改迭代 → 合并批准
```

### 2.2 审查清单

#### 🔒 安全审查
- [ ] 无硬编码敏感信息（密码、密钥、API Token）
- [ ] 输入参数进行了有效性校验
- [ ] 无SQL注入风险（使用参数化查询）
- [ ] 无XSS攻击风险（对用户输入进行转义）
- [ ] 文件上传进行了类型和大小限制
- [ ] 权限校验完整（接口级、数据级权限）

#### ⚡ 性能审查
- [ ] 无N+1查询问题
- [ ] 大数据量操作有分页或分批处理
- [ ] 缓存使用合理，有失效策略
- [ ] 无内存泄漏风险（资源及时释放）
- [ ] 循环体内无重复创建对象

#### 🛠 代码质量
- [ ] 遵循项目代码规范（命名、结构、注释）
- [ ] 无过度复杂方法（单一职责）
- [ ] 无魔法数字/字符串
- [ ] 异常处理完整（捕获具体异常，有日志）
- [ ] 日志记录恰当（级别、信息完整）

#### 📚 可维护性
- [ ] 有清晰的代码注释（复杂逻辑说明）
- [ ] 函数/方法长度控制在50行以内
- [ ] 类职责单一，无上帝类
- [ ] 依赖注入，无硬编码依赖

### 2.3 PR描述模板
```markdown
## 变更类型
- [ ] 新功能
- [ ] Bug修复
- [ ] 重构
- [ ] 文档更新
- [ ] 其他

## 变更描述
<!-- 简要描述本次变更的内容和目的 -->

## 关联Issue
<!-- 关联的Issue编号，如：Fix #123 -->

## 测试验证
- [ ] 单元测试已添加/更新
- [ ] 集成测试通过
- [ ] 手动测试场景及结果

## 影响范围
<!-- 描述变更影响的范围，数据库变更、API变更等 -->

##  checklist
- [ ] 代码遵循项目规范
- [ ] 自测通过
- [ ] 文档已更新（如有需要）
```

## 3. 质量门禁规范

### 3.1 自动化门禁检查

#### 代码静态分析
```yaml
# SonarQube配置示例
sonar:
  quality_gate:
    - coverage >= 80%
    - duplicated_lines <= 3%
    - security_rating >= A
    - reliability_rating >= A
    - maintainability_rating >= A
```

#### 构建检查
- [ ] 所有单元测试通过
- [ ] 集成测试通过
- [ ] 编译无警告
- [ ] 代码覆盖率不低于阈值（后端80%，前端60%）

#### 安全扫描
- [ ] 依赖组件漏洞扫描通过
- [ ] 代码安全扫描无高危问题
- [ ] 敏感信息扫描通过

### 3.2 人工门禁检查

#### 架构师审查（需要时）
- [ ] 架构设计符合规范
- [ ] 无循环依赖
- [ ] 接口设计合理

#### 技术负责人批准
- [ ] 代码符合技术路线
- [ ] 无重大技术债务引入
- [ ] 变更影响评估完成

## 4. 审查工具配置

### 4.1 后端项目（Java）
```xml
<!-- pom.xml 配置示例 -->
<plugin>
    <groupId>org.sonarsource.scanner.maven</groupId>
    <artifactId>sonar-maven-plugin</artifactId>
    <version>3.9.1</version>
</plugin>
<plugin>
    <groupId>org.jacoco</groupId>
    <artifactId>jacoco-maven-plugin</artifactId>
    <version>0.8.8</version>
</plugin>
```

### 4.2 前端项目
```json
{
  "scripts": {
    "lint": "eslint src --ext .js,.jsx,.ts,.tsx",
    "test:coverage": "jest --coverage",
    "sonar": "sonar-scanner"
  },
  "devDependencies": {
    "eslint": "^8.0.0",
    "jest": "^29.0.0"
  }
}
```