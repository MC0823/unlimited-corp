# M4é˜¶æ®µï¼šå‰ç«¯æ•´åˆå¼€å‘ä»»åŠ¡

## é˜¶æ®µä¿¡æ¯
| é¡¹ç›® | å†…å®¹ |
|------|------|
| é˜¶æ®µä»£å· | M4 |
| é˜¶æ®µåç§° | å‰ç«¯æ•´åˆ |
| é¢„è®¡å‘¨æœŸ | ç¬¬27-35å‘¨ï¼ˆçº¦2ä¸ªæœˆï¼‰ |
| æ ¸å¿ƒç›®æ ‡ | å®Œæˆå‰ç«¯ç•Œé¢ä¸ç³»ç»Ÿè”è°ƒ |

---

## 1. é˜¶æ®µç›®æ ‡

### 1.1 äº¤ä»˜ç‰©æ¸…å•

- [ ] CEOé©¾é©¶èˆ±é¦–é¡µ
- [ ] ä»»åŠ¡æ§åˆ¶ä¸­å¿ƒ
- [ ] å‘˜å·¥ç®¡ç†ç•Œé¢
- [ ] æŠ€èƒ½å¡ç®¡ç†ç•Œé¢
- [ ] ç§äººç§˜ä¹¦å¯¹è¯äº¤äº’
- [ ] WebSocketå®æ—¶é€šä¿¡
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡

### 1.2 éªŒæ”¶æ ‡å‡†

| éªŒæ”¶é¡¹ | æ ‡å‡† |
|--------|------|
| é©¾é©¶èˆ± | æ˜¾ç¤ºKPIã€ä»»åŠ¡åˆ—è¡¨ã€æ´»åŠ¨æµ |
| ä»»åŠ¡ä¸­å¿ƒ | å¯æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨å’Œè¯¦æƒ… |
| å‘˜å·¥ç®¡ç† | å¯æ‹›å‹Ÿã€è£…å¤‡æŠ€èƒ½ã€æŸ¥çœ‹çŠ¶æ€ |
| æŠ€èƒ½å¡ | å¯æµè§ˆã€æŸ¥çœ‹è¯¦æƒ…ã€æµ‹è¯• |
| ç§˜ä¹¦äº¤äº’ | å¯å‘é€æŒ‡ä»¤ã€åˆ›å»ºä»»åŠ¡ |
| å®æ—¶æ›´æ–° | ä»»åŠ¡è¿›åº¦å®æ—¶åˆ·æ–° |

---

## 2. å‰ç«¯æ¶æ„è®¾è®¡

### 2.1 é¡¹ç›®ç»“æ„

```
frontend/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ icons/                    # å›¾æ ‡èµ„æº
â”‚   â””â”€â”€ avatars/                  # å¤´åƒèµ„æº
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                      # APIè¯·æ±‚
â”‚   â”‚   â”œâ”€â”€ client.ts             # Axiosé…ç½®
â”‚   â”‚   â”œâ”€â”€ auth.ts               # è®¤è¯API
â”‚   â”‚   â”œâ”€â”€ skillcard.ts          # æŠ€èƒ½å¡API
â”‚   â”‚   â”œâ”€â”€ employee.ts           # å‘˜å·¥API
â”‚   â”‚   â”œâ”€â”€ task.ts               # ä»»åŠ¡API
â”‚   â”‚   â”œâ”€â”€ workflow.ts           # å·¥ä½œæµAPI
â”‚   â”‚   â”œâ”€â”€ dashboard.ts          # é©¾é©¶èˆ±API
â”‚   â”‚   â””â”€â”€ secretary.ts          # ç§˜ä¹¦API
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                   # åŸºç¡€UIç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”‚   â”œâ”€â”€ Card/
â”‚   â”‚   â”‚   â”œâ”€â”€ Modal/
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ layout/               # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Header/
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar/
â”‚   â”‚   â”‚   â””â”€â”€ MainLayout/
â”‚   â”‚   â””â”€â”€ business/             # ä¸šåŠ¡ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ SkillCardItem/
â”‚   â”‚       â”œâ”€â”€ EmployeeCard/
â”‚   â”‚       â”œâ”€â”€ TaskCard/
â”‚   â”‚       â””â”€â”€ SecretaryChat/
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ useWebSocket.ts
â”‚   â”‚   â””â”€â”€ useToast.ts
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ Login/
â”‚   â”‚   â”‚   â””â”€â”€ Register/
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â””â”€â”€ Dashboard/
â”‚   â”‚   â”œâ”€â”€ tasks/
â”‚   â”‚   â”‚   â”œâ”€â”€ TaskList/
â”‚   â”‚   â”‚   â””â”€â”€ TaskDetail/
â”‚   â”‚   â”œâ”€â”€ employees/
â”‚   â”‚   â”‚   â”œâ”€â”€ EmployeeList/
â”‚   â”‚   â”‚   â””â”€â”€ TalentMarket/
â”‚   â”‚   â”œâ”€â”€ skillcards/
â”‚   â”‚   â”‚   â”œâ”€â”€ SkillCardList/
â”‚   â”‚   â”‚   â””â”€â”€ SkillCardDetail/
â”‚   â”‚   â””â”€â”€ secretary/
â”‚   â”‚       â””â”€â”€ SecretaryPanel/
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”œâ”€â”€ authStore.ts
â”‚   â”‚   â”œâ”€â”€ employeeStore.ts
â”‚   â”‚   â”œâ”€â”€ taskStore.ts
â”‚   â”‚   â””â”€â”€ notificationStore.ts
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”œâ”€â”€ skillcard.ts
â”‚   â”‚   â”œâ”€â”€ employee.ts
â”‚   â”‚   â”œâ”€â”€ task.ts
â”‚   â”‚   â””â”€â”€ workflow.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ format.ts
â”‚   â”‚   â”œâ”€â”€ storage.ts
â”‚   â”‚   â””â”€â”€ constants.ts
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â””â”€â”€ globals.css
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ main.tsx
â”‚   â””â”€â”€ router.tsx
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tailwind.config.js
â””â”€â”€ vite.config.ts
```

### 2.2 è·¯ç”±è®¾è®¡

```tsx
// src/router.tsx
const routes = [
  {
    path: '/login',
    element: <Login />,
  },
  {
    path: '/register',
    element: <Register />,
  },
  {
    path: '/',
    element: <MainLayout />,
    children: [
      { path: '', element: <Dashboard /> },
      { path: 'tasks', element: <TaskList /> },
      { path: 'tasks/:id', element: <TaskDetail /> },
      { path: 'employees', element: <EmployeeList /> },
      { path: 'talent-market', element: <TalentMarket /> },
      { path: 'skillcards', element: <SkillCardList /> },
      { path: 'skillcards/:id', element: <SkillCardDetail /> },
      { path: 'workflows', element: <WorkflowList /> },
    ],
  },
];
```

---

## 3. ä»»åŠ¡æ‹†è§£

### 3.1 ä»»åŠ¡ä¾èµ–å›¾

```mermaid
graph TD
    T1[å‰ç«¯é¡¹ç›®åˆå§‹åŒ–] --> T2[APIå±‚å°è£…]
    T2 --> T3[çŠ¶æ€ç®¡ç†]
    T3 --> T4[è®¤è¯é¡µé¢]
    T4 --> T5[ä¸»å¸ƒå±€]
    T5 --> T6[é©¾é©¶èˆ±é¡µé¢]
    T5 --> T7[å‘˜å·¥ç®¡ç†é¡µé¢]
    T5 --> T8[æŠ€èƒ½å¡é¡µé¢]
    T5 --> T9[ä»»åŠ¡ä¸­å¿ƒé¡µé¢]
    T6 --> T10[ç§˜ä¹¦äº¤äº’ç»„ä»¶]
    T9 --> T11[WebSocketé›†æˆ]
    T11 --> T12[è”è°ƒæµ‹è¯•]
```

### 3.2 è¯¦ç»†ä»»åŠ¡åˆ—è¡¨

---

#### T1: å‰ç«¯é¡¹ç›®åˆå§‹åŒ–
**é¢„è®¡æ—¶é—´**: 2å¤©

```bash
# ä½¿ç”¨Viteåˆ›å»ºReact TypeScripté¡¹ç›®
pnpm create vite frontend --template react-ts

# å®‰è£…æ ¸å¿ƒä¾èµ–
cd frontend
pnpm add react-router-dom zustand axios @tanstack/react-query
pnpm add antd dayjs socket.io-client framer-motion
pnpm add -D tailwindcss postcss autoprefixer
pnpm add -D @types/node

# åˆå§‹åŒ–Tailwind
npx tailwindcss init -p
```

é…ç½®æ–‡ä»¶ï¼š
```ts
// vite.config.ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true,
      },
      '/ws': {
        target: 'ws://localhost:8000',
        ws: true,
      },
    },
  },
})
```

---

#### T2: APIå±‚å°è£…
**é¢„è®¡æ—¶é—´**: 2å¤©

```ts
// src/api/client.ts
import axios, { AxiosInstance, AxiosError } from 'axios'
import { useAuthStore } from '@/stores/authStore'

const client: AxiosInstance = axios.create({
  baseURL: '/api/v1',
  timeout: 30000,
})

// è¯·æ±‚æ‹¦æˆªå™¨
client.interceptors.request.use((config) => {
  const token = useAuthStore.getState().accessToken
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  config.headers['X-Request-ID'] = crypto.randomUUID()
  return config
})

// å“åº”æ‹¦æˆªå™¨
client.interceptors.response.use(
  (response) => response.data,
  async (error: AxiosError) => {
    if (error.response?.status === 401) {
      // å°è¯•åˆ·æ–°Token
      const refreshed = await useAuthStore.getState().refreshToken()
      if (refreshed && error.config) {
        return client.request(error.config)
      }
      useAuthStore.getState().logout()
    }
    return Promise.reject(error)
  }
)

export default client

// src/api/auth.ts
import client from './client'

export const authApi = {
  register: (data: RegisterRequest) => 
    client.post<ApiResponse<AuthResponse>>('/auth/register', data),
  
  login: (data: LoginRequest) => 
    client.post<ApiResponse<AuthResponse>>('/auth/login', data),
  
  refresh: (refreshToken: string) =>
    client.post<ApiResponse<TokenPair>>('/auth/refresh', { refreshToken }),
  
  getProfile: () =>
    client.get<ApiResponse<UserProfile>>('/users/me'),
}

// src/api/employee.ts
export const employeeApi = {
  list: (params?: EmployeeFilter) =>
    client.get<ApiResponse<EmployeeListResponse>>('/employees', { params }),
  
  recruit: (data: RecruitRequest) =>
    client.post<ApiResponse<Employee>>('/employees', data),
  
  dismiss: (id: string, force?: boolean) =>
    client.delete(`/employees/${id}`, { params: { force } }),
  
  equipSkill: (id: string, skillCardId: string) =>
    client.post(`/employees/${id}/equip`, { skillCardId }),
  
  unequipSkill: (id: string) =>
    client.delete(`/employees/${id}/equip`),
  
  getTemplates: () =>
    client.get<ApiResponse<EmployeeTemplate[]>>('/talent-market'),
}
```

---

#### T3: çŠ¶æ€ç®¡ç†
**é¢„è®¡æ—¶é—´**: 1å¤©

```ts
// src/stores/authStore.ts
import { create } from 'zustand'
import { persist } from 'zustand/middleware'
import { authApi } from '@/api/auth'

interface AuthState {
  user: User | null
  company: Company | null
  accessToken: string | null
  refreshToken: string | null
  isAuthenticated: boolean
  login: (email: string, password: string) => Promise<void>
  register: (data: RegisterRequest) => Promise<void>
  logout: () => void
  refreshToken: () => Promise<boolean>
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set, get) => ({
      user: null,
      company: null,
      accessToken: null,
      refreshToken: null,
      isAuthenticated: false,
      
      login: async (email, password) => {
        const res = await authApi.login({ email, password })
        set({
          user: res.data,
          company: res.data.company,
          accessToken: res.data.tokens.accessToken,
          refreshToken: res.data.tokens.refreshToken,
          isAuthenticated: true,
        })
      },
      
      logout: () => {
        set({
          user: null,
          company: null,
          accessToken: null,
          refreshToken: null,
          isAuthenticated: false,
        })
      },
      
      refreshToken: async () => {
        const token = get().refreshToken
        if (!token) return false
        try {
          const res = await authApi.refresh(token)
          set({
            accessToken: res.data.accessToken,
            refreshToken: res.data.refreshToken,
          })
          return true
        } catch {
          return false
        }
      },
    }),
    { name: 'auth-storage' }
  )
)

// src/stores/employeeStore.ts
import { create } from 'zustand'
import { employeeApi } from '@/api/employee'

interface EmployeeState {
  employees: Employee[]
  loading: boolean
  fetchEmployees: () => Promise<void>
  recruitEmployee: (templateId: string, name?: string) => Promise<void>
  equipSkill: (employeeId: string, skillCardId: string) => Promise<void>
}

export const useEmployeeStore = create<EmployeeState>((set, get) => ({
  employees: [],
  loading: false,
  
  fetchEmployees: async () => {
    set({ loading: true })
    const res = await employeeApi.list()
    set({ employees: res.data.items, loading: false })
  },
  
  recruitEmployee: async (templateId, name) => {
    await employeeApi.recruit({ templateId, name })
    get().fetchEmployees()
  },
  
  equipSkill: async (employeeId, skillCardId) => {
    await employeeApi.equipSkill(employeeId, skillCardId)
    get().fetchEmployees()
  },
}))
```

---

#### T4: è®¤è¯é¡µé¢
**é¢„è®¡æ—¶é—´**: 2å¤©

```tsx
// src/pages/auth/Login/index.tsx
import { useState } from 'react'
import { useNavigate, Link } from 'react-router-dom'
import { Form, Input, Button, message } from 'antd'
import { useAuthStore } from '@/stores/authStore'

export default function Login() {
  const [loading, setLoading] = useState(false)
  const navigate = useNavigate()
  const login = useAuthStore((s) => s.login)
  
  const onFinish = async (values: { email: string; password: string }) => {
    setLoading(true)
    try {
      await login(values.email, values.password)
      message.success('ç™»å½•æˆåŠŸ')
      navigate('/')
    } catch (err) {
      message.error('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é‚®ç®±å’Œå¯†ç ')
    } finally {
      setLoading(false)
    }
  }
  
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-900">
      <div className="w-full max-w-md p-8 bg-gray-800 rounded-xl">
        <h1 className="text-2xl font-bold text-white text-center mb-8">
          æ— é™å…¬å¸ CEOç™»å½•
        </h1>
        
        <Form layout="vertical" onFinish={onFinish}>
          <Form.Item 
            name="email" 
            label={<span className="text-gray-300">é‚®ç®±</span>}
            rules={[{ required: true, type: 'email' }]}
          >
            <Input size="large" placeholder="è¯·è¾“å…¥é‚®ç®±" />
          </Form.Item>
          
          <Form.Item 
            name="password" 
            label={<span className="text-gray-300">å¯†ç </span>}
            rules={[{ required: true, min: 8 }]}
          >
            <Input.Password size="large" placeholder="è¯·è¾“å…¥å¯†ç " />
          </Form.Item>
          
          <Button 
            type="primary" 
            htmlType="submit" 
            size="large" 
            block 
            loading={loading}
          >
            ç™»å½•
          </Button>
        </Form>
        
        <div className="mt-4 text-center text-gray-400">
          è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<Link to="/register" className="text-blue-400">ç«‹å³æ³¨å†Œ</Link>
        </div>
      </div>
    </div>
  )
}
```

---

#### T5: ä¸»å¸ƒå±€
**é¢„è®¡æ—¶é—´**: 2å¤©

```tsx
// src/components/layout/MainLayout/index.tsx
import { Outlet } from 'react-router-dom'
import Header from '../Header'
import Sidebar from '../Sidebar'
import SecretaryPanel from '@/pages/secretary/SecretaryPanel'

export default function MainLayout() {
  return (
    <div className="min-h-screen bg-gray-900 text-white">
      <Header />
      <div className="flex">
        <Sidebar />
        <main className="flex-1 p-6 ml-64">
          <Outlet />
        </main>
      </div>
      <SecretaryPanel />
    </div>
  )
}

// src/components/layout/Sidebar/index.tsx
import { NavLink } from 'react-router-dom'
import { 
  HomeOutlined, 
  TeamOutlined, 
  AppstoreOutlined,
  PlayCircleOutlined,
  SettingOutlined 
} from '@ant-design/icons'

const navItems = [
  { path: '/', icon: HomeOutlined, label: 'é©¾é©¶èˆ±' },
  { path: '/tasks', icon: PlayCircleOutlined, label: 'ä»»åŠ¡ä¸­å¿ƒ' },
  { path: '/employees', icon: TeamOutlined, label: 'å‘˜å·¥ç®¡ç†' },
  { path: '/skillcards', icon: AppstoreOutlined, label: 'æŠ€èƒ½å¡' },
  { path: '/workflows', icon: SettingOutlined, label: 'å·¥ä½œæµ' },
]

export default function Sidebar() {
  return (
    <aside className="fixed left-0 top-16 w-64 h-[calc(100vh-4rem)] bg-gray-800 p-4">
      <nav className="space-y-2">
        {navItems.map((item) => (
          <NavLink
            key={item.path}
            to={item.path}
            className={({ isActive }) =>
              `flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${
                isActive 
                  ? 'bg-blue-600 text-white' 
                  : 'text-gray-300 hover:bg-gray-700'
              }`
            }
          >
            <item.icon />
            <span>{item.label}</span>
          </NavLink>
        ))}
      </nav>
    </aside>
  )
}
```

---

#### T6: é©¾é©¶èˆ±é¡µé¢
**é¢„è®¡æ—¶é—´**: 4å¤©

```tsx
// src/pages/dashboard/Dashboard/index.tsx
import { useEffect } from 'react'
import { useQuery } from '@tanstack/react-query'
import { dashboardApi } from '@/api/dashboard'
import KPICards from './components/KPICards'
import TaskProgress from './components/TaskProgress'
import ActivityFeed from './components/ActivityFeed'
import QuickCommand from './components/QuickCommand'
import AlertPanel from './components/AlertPanel'

export default function Dashboard() {
  const { data, isLoading } = useQuery({
    queryKey: ['dashboard'],
    queryFn: dashboardApi.getOverview,
    refetchInterval: 30000, // 30ç§’åˆ·æ–°
  })
  
  if (isLoading) return <LoadingSkeleton />
  
  return (
    <div className="space-y-6">
      {/* KPIå¡ç‰‡ */}
      <KPICards kpis={data?.kpis} />
      
      <div className="grid grid-cols-3 gap-6">
        {/* å·¦ä¾§ï¼šä»»åŠ¡è¿›åº¦ */}
        <div className="col-span-2 space-y-6">
          <TaskProgress tasks={data?.runningTasks} />
          <QuickCommand />
        </div>
        
        {/* å³ä¾§ï¼šé¢„è­¦å’Œæ´»åŠ¨æµ */}
        <div className="space-y-6">
          <AlertPanel alerts={data?.alerts} />
          <ActivityFeed />
        </div>
      </div>
    </div>
  )
}

// components/KPICards.tsx
function KPICards({ kpis }) {
  const items = [
    { key: 'todayTasks', label: 'ä»Šæ—¥ä»»åŠ¡', icon: 'ğŸ“‹' },
    { key: 'successRate', label: 'æˆåŠŸç‡', icon: 'âœ…', format: 'percent' },
    { key: 'teamEfficiency', label: 'å›¢é˜Ÿæ•ˆç‡', icon: 'âš¡', format: 'percent' },
    { key: 'activeEmployees', label: 'æ´»è·ƒå‘˜å·¥', icon: 'ğŸ‘¥' },
  ]
  
  return (
    <div className="grid grid-cols-4 gap-4">
      {items.map((item) => (
        <div key={item.key} className="bg-gray-800 rounded-xl p-4">
          <div className="flex items-center gap-2 text-gray-400 mb-2">
            <span>{item.icon}</span>
            <span>{item.label}</span>
          </div>
          <div className="text-2xl font-bold">
            {formatValue(kpis?.[item.key]?.value, item.format)}
          </div>
          {kpis?.[item.key]?.change && (
            <div className={`text-sm ${
              kpis[item.key].changeType === 'increase' 
                ? 'text-green-400' 
                : 'text-red-400'
            }`}>
              {kpis[item.key].changeType === 'increase' ? 'â†‘' : 'â†“'}
              {Math.abs(kpis[item.key].change * 100).toFixed(1)}%
            </div>
          )}
        </div>
      ))}
    </div>
  )
}
```

---

#### T7-T9: å‘˜å·¥/æŠ€èƒ½å¡/ä»»åŠ¡é¡µé¢
**é¢„è®¡æ—¶é—´**: 6å¤©

å…³é”®ç»„ä»¶ï¼š

```tsx
// å‘˜å·¥å¡ç‰‡ç»„ä»¶
// src/components/business/EmployeeCard/index.tsx
export function EmployeeCard({ employee, onEquip, onDismiss }) {
  return (
    <div className="bg-gray-800 rounded-xl p-4 flex gap-4">
      <img 
        src={employee.avatarUrl} 
        alt={employee.name}
        className="w-16 h-16 rounded-full"
      />
      <div className="flex-1">
        <div className="flex items-center gap-2">
          <h3 className="font-medium">{employee.name}</h3>
          <span className={`px-2 py-0.5 rounded text-xs ${
            employee.status === 'idle' 
              ? 'bg-green-900 text-green-300' 
              : 'bg-yellow-900 text-yellow-300'
          }`}>
            {employee.status === 'idle' ? 'ç©ºé—²' : 'å·¥ä½œä¸­'}
          </span>
        </div>
        
        {employee.skillEquip ? (
          <div className="mt-2 text-sm text-gray-400">
            è£…å¤‡æŠ€èƒ½ï¼š{employee.skillEquip.skillCardName}
          </div>
        ) : (
          <Button size="small" onClick={onEquip}>è£…å¤‡æŠ€èƒ½</Button>
        )}
        
        <div className="mt-2 flex gap-4 text-xs text-gray-500">
          <span>ä»Šæ—¥: {employee.performance.todayTasks}ä¸ª</span>
          <span>æˆåŠŸç‡: {(employee.performance.successRate * 100).toFixed(0)}%</span>
        </div>
      </div>
    </div>
  )
}

// ä»»åŠ¡å¡ç‰‡ç»„ä»¶
// src/components/business/TaskCard/index.tsx
export function TaskCard({ task, onClick }) {
  return (
    <div 
      className="bg-gray-800 rounded-xl p-4 cursor-pointer hover:bg-gray-750"
      onClick={() => onClick(task.id)}
    >
      <div className="flex justify-between items-start mb-3">
        <h3 className="font-medium">{task.name}</h3>
        <TaskStatusBadge status={task.status} />
      </div>
      
      <div className="mb-3">
        <div className="flex justify-between text-sm text-gray-400 mb-1">
          <span>è¿›åº¦</span>
          <span>{task.progress}%</span>
        </div>
        <div className="h-2 bg-gray-700 rounded-full overflow-hidden">
          <div 
            className="h-full bg-blue-500 rounded-full transition-all"
            style={{ width: `${task.progress}%` }}
          />
        </div>
      </div>
      
      {task.currentStep && (
        <div className="text-sm text-gray-400">
          å½“å‰ï¼š{task.currentStep.name} ({task.currentStep.employeeName})
        </div>
      )}
    </div>
  )
}
```

---

#### T10: ç§˜ä¹¦äº¤äº’ç»„ä»¶
**é¢„è®¡æ—¶é—´**: 3å¤©

```tsx
// src/pages/secretary/SecretaryPanel/index.tsx
import { useState, useRef, useEffect } from 'react'
import { secretaryApi } from '@/api/secretary'
import { motion, AnimatePresence } from 'framer-motion'

export default function SecretaryPanel() {
  const [isOpen, setIsOpen] = useState(false)
  const [messages, setMessages] = useState<Message[]>([])
  const [input, setInput] = useState('')
  const [loading, setLoading] = useState(false)
  const messagesEndRef = useRef<HTMLDivElement>(null)
  
  const sendMessage = async () => {
    if (!input.trim() || loading) return
    
    const userMessage = { role: 'user', content: input }
    setMessages((prev) => [...prev, userMessage])
    setInput('')
    setLoading(true)
    
    try {
      const res = await secretaryApi.sendCommand({ message: input })
      const assistantMessage = {
        role: 'assistant',
        content: res.data.response.text,
        actions: res.data.response.actions,
      }
      setMessages((prev) => [...prev, assistantMessage])
    } catch (err) {
      setMessages((prev) => [...prev, {
        role: 'assistant',
        content: 'æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œè¯·ç¨åå†è¯•ã€‚',
      }])
    } finally {
      setLoading(false)
    }
  }
  
  const handleAction = async (action: Action) => {
    if (action.type === 'confirm') {
      await secretaryApi.executeCommand({
        actionType: 'confirm',
        payload: action.payload,
      })
      setMessages((prev) => [...prev, {
        role: 'assistant',
        content: 'å¥½çš„ï¼Œæ­£åœ¨ä¸ºæ‚¨æ‰§è¡Œ...',
      }])
    }
  }
  
  return (
    <>
      {/* ç§˜ä¹¦å¤´åƒæŒ‰é’® */}
      <div className="fixed right-6 bottom-6 flex gap-2">
        <button
          onClick={() => setIsOpen(true)}
          className="w-14 h-14 rounded-full bg-blue-600 flex items-center justify-center shadow-lg hover:bg-blue-700 transition-colors"
        >
          <span className="text-2xl">ğŸ’¬</span>
        </button>
      </div>
      
      {/* å¯¹è¯é¢æ¿ */}
      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: 20 }}
            className="fixed right-6 bottom-24 w-96 h-[500px] bg-gray-800 rounded-xl shadow-xl flex flex-col"
          >
            {/* å¤´éƒ¨ */}
            <div className="p-4 border-b border-gray-700 flex justify-between items-center">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center">
                  <span>ğŸ¤–</span>
                </div>
                <div>
                  <h3 className="font-medium">å°æ™º</h3>
                  <span className="text-xs text-gray-400">ç§äººç§˜ä¹¦</span>
                </div>
              </div>
              <button onClick={() => setIsOpen(false)} className="text-gray-400">âœ•</button>
            </div>
            
            {/* æ¶ˆæ¯åˆ—è¡¨ */}
            <div className="flex-1 overflow-y-auto p-4 space-y-4">
              {messages.map((msg, idx) => (
                <div 
                  key={idx} 
                  className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
                >
                  <div className={`max-w-[80%] rounded-lg p-3 ${
                    msg.role === 'user' 
                      ? 'bg-blue-600' 
                      : 'bg-gray-700'
                  }`}>
                    {msg.content}
                    {msg.actions && (
                      <div className="mt-2 flex gap-2 flex-wrap">
                        {msg.actions.map((action, i) => (
                          <button
                            key={i}
                            onClick={() => handleAction(action)}
                            className="px-3 py-1 bg-blue-500 rounded text-sm hover:bg-blue-400"
                          >
                            {action.label}
                          </button>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              ))}
              {loading && (
                <div className="flex justify-start">
                  <div className="bg-gray-700 rounded-lg p-3">
                    <span className="animate-pulse">æ­£åœ¨æ€è€ƒ...</span>
                  </div>
                </div>
              )}
              <div ref={messagesEndRef} />
            </div>
            
            {/* è¾“å…¥æ¡† */}
            <div className="p-4 border-t border-gray-700">
              <div className="flex gap-2">
                <input
                  value={input}
                  onChange={(e) => setInput(e.target.value)}
                  onKeyDown={(e) => e.key === 'Enter' && sendMessage()}
                  placeholder="æœ‰ä»€ä¹ˆéœ€è¦å¸®å¿™çš„å—ï¼Ÿ"
                  className="flex-1 bg-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
                <button 
                  onClick={sendMessage}
                  disabled={loading}
                  className="px-4 py-2 bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50"
                >
                  å‘é€
                </button>
              </div>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </>
  )
}
```

---

#### T11: WebSocketé›†æˆ
**é¢„è®¡æ—¶é—´**: 2å¤©

```ts
// src/hooks/useWebSocket.ts
import { useEffect, useRef, useCallback } from 'react'
import { io, Socket } from 'socket.io-client'
import { useAuthStore } from '@/stores/authStore'

export function useWebSocket(channels: string[], onMessage: (event: WsEvent) => void) {
  const socketRef = useRef<Socket | null>(null)
  const accessToken = useAuthStore((s) => s.accessToken)
  
  useEffect(() => {
    if (!accessToken) return
    
    const socket = io('/ws', {
      auth: { token: accessToken },
      transports: ['websocket'],
    })
    
    socketRef.current = socket
    
    socket.on('connect', () => {
      console.log('WebSocket connected')
      socket.emit('subscribe', { channels })
    })
    
    socket.on('event', (data: WsEvent) => {
      onMessage(data)
    })
    
    socket.on('disconnect', () => {
      console.log('WebSocket disconnected')
    })
    
    return () => {
      socket.disconnect()
    }
  }, [accessToken, channels, onMessage])
  
  const subscribe = useCallback((newChannels: string[]) => {
    socketRef.current?.emit('subscribe', { channels: newChannels })
  }, [])
  
  const unsubscribe = useCallback((removeChannels: string[]) => {
    socketRef.current?.emit('unsubscribe', { channels: removeChannels })
  }, [])
  
  return { subscribe, unsubscribe }
}

// åœ¨ä»»åŠ¡è¯¦æƒ…é¡µä½¿ç”¨
export function TaskDetail() {
  const { id } = useParams()
  const [task, setTask] = useState<Task | null>(null)
  
  const handleWsEvent = useCallback((event: WsEvent) => {
    if (event.event === 'progress_updated') {
      setTask((prev) => prev ? { ...prev, progress: event.data.progress } : null)
    }
    if (event.event === 'step_completed') {
      // åˆ·æ–°ä»»åŠ¡è¯¦æƒ…
      refetch()
    }
  }, [])
  
  useWebSocket([`task.${id}`], handleWsEvent)
  
  // ...
}
```

---

#### T12: è”è°ƒæµ‹è¯•
**é¢„è®¡æ—¶é—´**: 3å¤©

ç«¯åˆ°ç«¯æµ‹è¯•åœºæ™¯ï¼š
1. ç”¨æˆ·æ³¨å†Œç™»å½•æµç¨‹
2. å‘˜å·¥æ‹›å‹Ÿè£…å¤‡æŠ€èƒ½æµç¨‹
3. åˆ›å»ºå¹¶æ‰§è¡Œä»»åŠ¡æµç¨‹
4. æŸ¥çœ‹ä»»åŠ¡è¿›åº¦å®æ—¶æ›´æ–°
5. ç§˜ä¹¦æŒ‡ä»¤åˆ›å»ºä»»åŠ¡

---

## 4. è¿›åº¦è·Ÿè¸ª

| ä»»åŠ¡ | çŠ¶æ€ | å¼€å§‹æ—¶é—´ | å®Œæˆæ—¶é—´ | å¤‡æ³¨ |
|------|------|----------|----------|------|
| T1: å‰ç«¯é¡¹ç›®åˆå§‹åŒ– | PENDING | - | - | - |
| T2: APIå±‚å°è£… | PENDING | - | - | - |
| T3: çŠ¶æ€ç®¡ç† | PENDING | - | - | - |
| T4: è®¤è¯é¡µé¢ | PENDING | - | - | - |
| T5: ä¸»å¸ƒå±€ | PENDING | - | - | - |
| T6: é©¾é©¶èˆ±é¡µé¢ | PENDING | - | - | - |
| T7: å‘˜å·¥ç®¡ç†é¡µé¢ | PENDING | - | - | - |
| T8: æŠ€èƒ½å¡é¡µé¢ | PENDING | - | - | - |
| T9: ä»»åŠ¡ä¸­å¿ƒé¡µé¢ | PENDING | - | - | - |
| T10: ç§˜ä¹¦äº¤äº’ç»„ä»¶ | PENDING | - | - | - |
| T11: WebSocketé›†æˆ | PENDING | - | - | - |
| T12: è”è°ƒæµ‹è¯• | PENDING | - | - | - |

---

*æ–‡æ¡£ç»“æŸ*
